# Python API for Receipts Scanner

This API provides the image processing and item categorization functionality for Receipts Scanner.

## Local development

### Without Docker
You can use any Python environment manager you like (venv/Conda).

#### Conda
- `conda create -n pythonapi python=3.8` to create a new environment
- `conda activate pythonapi` to activate that environment
- `pip install -r requirements.txt` to install all required dependencies

Now you can run the server with `python service.py`.

### With Docker
Build a docker image:

- `docker build -t model .`

Run a docker container from the built image:

- `docker run -p 80:80 model`

## CI

By pushing code to `master` branch, the Docker image is automatically built thanks to the
`.github/workflows/python-apl.yml` pipeline. It is then published to Azure Container Registry. From there, it is
deployed to Azure Container Instances.

The Python API service is available on http://pythonapi.westeurope.azurecontainer.io/.

Documentation of endpoints (generated by Postman) is
available [here](https://documenter.getpostman.com/view/9355808/TzJsfdUK).

### Logs

Logs are available at Azure Portal -> aci-python-api -> Containers -> Logs.

### Tests

The `tests/Receipts-Scanner-Python-API.postman_collection.json` contains Postman tests that are run during the pipeline. To run them
locally,
run `cd python-api/tests/ && npx -y newman run Receipts-Scanner-Python-API.postman_collection.json -e local.postman_environment.json && cd ../../`

If you make changes in the Postman collection and its tests,
reexport the collection from Postman and put it inside `~/python-api/tests/`.
Run `npm run prettier:format` to reformat the json of that collectio.
Follow the same process if changing Postman environment.


### Resources:

- https://github.com/plasticityai/magnitude
- https://www.alibabacloud.com/blog/how-to-create-and-deploy-a-pre-trained-word2vec-deep-learning-rest-api_594064
- https://docs.microsoft.com/cs-cz/azure/container-instances/container-instances-github-action
- https://flask.palletsprojects.com/en/1.1.x/testing/
- https://medium.com/weekly-webtips/using-github-actions-for-integration-testing-on-a-rest-api-358991d54a20
